<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initial Setup - Printer Proxy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --background: hsl(0 0% 98%);
            --foreground: hsl(222.2 47.4% 11.2%);
            --muted: hsl(215.4 16.3% 46.9%);
            --border: hsl(214.3 31.8% 91.4%);
            --primary: hsl(222.2 47.4% 11.2%);
            --primary-foreground: hsl(210 40% 98%);
            --ring: hsl(215 20.2% 65.1%);
            --card-bg: hsl(0 0% 100%);
            --success: hsl(142 76% 36%);
            --danger: hsl(0 84% 60%);
            --warning: hsl(48 96% 53%);
            --info: hsl(214 95% 50%);
        }
        
        body {
            background-color: var(--background);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .setup-card {
            width: 550px;
            max-width: 100%;
            background: white;
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            overflow: hidden;
        }
        
        .setup-header {
            padding: 1.5rem 2rem 0;
            text-align: center;
        }
        
        .setup-header h1 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--foreground);
            margin: 0;
        }
        
        .setup-header p {
            font-size: 0.875rem;
            color: var(--muted);
            margin: 0.25rem 0 0;
        }
        
        .setup-body {
            padding: 1.5rem 2rem 2rem;
        }
        
        .form-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--foreground);
            margin-bottom: 0.375rem;
        }
        
        .form-input {
            display: block;
            width: 100%;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            line-height: 1.5;
            color: var(--foreground);
            background-color: white;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            transition: border-color 0.15s, box-shadow 0.15s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--ring);
            box-shadow: 0 0 0 3px hsl(215 20.2% 65.1% / 0.15);
        }
        
        .form-input::placeholder {
            color: var(--muted);
        }
        
        .form-hint {
            font-size: 0.75rem;
            color: var(--muted);
            margin-top: 0.25rem;
        }
        
        .btn-setup {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--primary-foreground);
            background-color: var(--primary);
            border: 1px solid var(--primary);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.15s, transform 0.1s;
            text-decoration: none;
        }
        
        .btn-setup:hover {
            background-color: hsl(222.2 47.4% 20%);
            color: var(--primary-foreground);
        }
        
        .btn-setup:active {
            transform: scale(0.98);
        }
        
        /* Toast styles */
        .toast-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            pointer-events: none;
        }
        .toast {
            pointer-events: auto;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            border-radius: 0.5rem;
            background: var(--card-bg);
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 320px;
            max-width: 420px;
            animation: toast-slide-in 0.3s cubic-bezier(0.21, 1.02, 0.73, 1);
        }
        .toast.toast-exit {
            animation: toast-slide-out 0.2s cubic-bezier(0.06, 0.71, 0.55, 1) forwards;
        }
        @keyframes toast-slide-in {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes toast-slide-out {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100%); }
        }
        .toast-icon {
            flex-shrink: 0;
            width: 1.25rem;
            height: 1.25rem;
            margin-top: 0.125rem;
        }
        .toast-content {
            flex: 1;
            font-size: 0.875rem;
            line-height: 1.4;
            color: var(--foreground);
        }
        .toast-close {
            flex-shrink: 0;
            background: none;
            border: none;
            padding: 0.25rem;
            cursor: pointer;
            color: var(--muted);
            transition: color 0.15s;
        }
        .toast-close:hover { color: var(--foreground); }
        .toast-success .toast-icon { color: var(--success); }
        .toast-error .toast-icon { color: var(--danger); }
        .toast-warning .toast-icon { color: var(--warning); }
        .toast-info .toast-icon { color: var(--info); }
        .toast-success { border-left: 3px solid var(--success); }
        .toast-error { border-left: 3px solid var(--danger); }
        .toast-warning { border-left: 3px solid var(--warning); }
        .toast-info { border-left: 3px solid var(--info); }
    </style>
</head>
<body>
    <div class="setup-card">
        <div class="setup-header">
            <h1>Initial Setup</h1>
        </div>
        <div class="setup-body">
            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                
                <div class="mb-3">
                    <label for="username" class="form-label">Admin Username</label>
                    <input type="text" class="form-input" id="username" name="username" 
                           placeholder="Choose a username" required autofocus minlength="3">
                </div>
                
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-input" id="password" name="password" 
                           placeholder="Choose a strong password" required minlength="8">
                    <p class="form-hint">
                        Minimum 8 characters with at least one uppercase and lowercase letter.
                    </p>
                </div>
                
                <div class="mb-4">
                    <label for="confirm_password" class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" id="confirm_password" 
                           name="confirm_password" placeholder="Confirm your password" required>
                </div>
                
                <button type="submit" class="btn-setup">
                    Create Admin Account
                </button>
            </form>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
    
    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <script>
            window.__flashMessages = [
                {% for category, message in messages %}
                { category: "{{ 'error' if category == 'error' else category }}", message: "{{ message|e }}" }{% if not loop.last %},{% endif %}
                {% endfor %}
            ];
        </script>
        {% endif %}
    {% endwith %}
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Toast notification system
        (function() {
            const icons = {
                success: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>',
                error: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',
                warning: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>',
                info: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>'
            };
            
            function showToast(message, category = 'info', duration = 5000) {
                const container = document.getElementById('toast-container');
                if (!container) return;
                
                const toast = document.createElement('div');
                const type = category === 'danger' ? 'error' : category;
                toast.className = `toast toast-${type}`;
                toast.innerHTML = `
                    <div class="toast-icon">${icons[type] || icons.info}</div>
                    <div class="toast-content">${message}</div>
                    <button class="toast-close" aria-label="Close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                `;
                
                container.appendChild(toast);
                
                const closeBtn = toast.querySelector('.toast-close');
                const dismiss = () => {
                    toast.classList.add('toast-exit');
                    setTimeout(() => toast.remove(), 200);
                };
                
                closeBtn.addEventListener('click', dismiss);
                if (duration > 0) setTimeout(dismiss, duration);
            }
            
            // Process flash messages on page load
            if (window.__flashMessages) {
                window.__flashMessages.forEach((msg, index) => {
                    setTimeout(() => showToast(msg.message, msg.category), index * 100);
                });
            }
        })();
    </script>
</body>
</html>
