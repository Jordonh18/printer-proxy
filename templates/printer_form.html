{% extends "base.html" %}

{% block title %}{{ 'Edit' if mode == 'edit' else 'Add' }} Printer - Printer Proxy{% endblock %}

{% block extra_css %}
<style>
    /* shadcn-inspired styling */
    .detail-card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 0.75rem;
        box-shadow: var(--card-shadow);
        overflow: hidden;
    }
    .detail-card-header {
        padding: 1rem 1.25rem;
        border-bottom: 1px solid var(--border);
        font-weight: 600;
        font-size: 1rem;
        color: var(--foreground);
    }
    .detail-card-body {
        padding: 1.5rem;
    }
    
    /* Form styling */
    .form-label-modern {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--foreground);
        margin-bottom: 0.5rem;
    }
    .form-label-modern .required {
        color: var(--danger);
    }
    
    .form-input {
        display: block;
        width: 100%;
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        line-height: 1.5;
        color: var(--foreground);
        background: var(--input-bg);
        border: 1px solid var(--border);
        border-radius: 0.5rem;
        transition: border-color 0.15s, box-shadow 0.15s;
    }
    .form-input:focus {
        outline: none;
        border-color: var(--input-focus);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .form-input:disabled, .form-input:read-only {
        background: var(--background-secondary);
        color: var(--muted);
    }
    .form-input::placeholder {
        color: var(--muted);
    }
    
    .form-hint {
        font-size: 0.75rem;
        color: var(--muted);
        margin-top: 0.375rem;
    }
    .form-error {
        font-size: 0.75rem;
        color: var(--danger);
        margin-top: 0.375rem;
        display: none;
    }
    .form-input:invalid + .form-error {
        display: block;
    }
    
    textarea.form-input {
        resize: vertical;
        min-height: 80px;
    }
    
    /* Alert styling */
    .alert-warning-modern {
        background: var(--warning-bg);
        border: 1px solid var(--warning);
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }
    .alert-warning-modern strong {
        color: var(--warning-text);
    }
    .alert-warning-modern p {
        color: var(--warning-text);
        font-size: 0.875rem;
        margin: 0;
    }
    
    /* Buttons */
    .btn-modern {
        padding: 0.5rem 1.25rem;
        border-radius: 0.5rem;
        font-weight: 500;
        font-size: 0.875rem;
        transition: all 0.15s;
        text-decoration: none;
    }
    .btn-primary-modern {
        background: var(--primary);
        color: var(--primary-foreground);
        border: none;
    }
    .btn-primary-modern:hover {
        background: var(--primary);
        color: var(--primary-foreground);
        text-decoration: none;
    }
    .btn-outline-modern {
        background: transparent;
        color: var(--foreground);
        border: 1px solid var(--border);
    }
    .btn-outline-modern:hover {
        background: var(--table-hover);
        border-color: var(--muted);
        color: var(--foreground);
        text-decoration: none;
    }
    
    /* Section divider */
    .form-section {
        margin-bottom: 1.25rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-7">
        <div class="detail-card">
            <div class="detail-card-header">
                {{ 'Edit Printer' if mode == 'edit' else 'Add New Printer' }}
            </div>
            <div class="detail-card-body">
                {% if mode == 'edit' and (has_redirect or is_target) %}
                <div class="alert-warning-modern">
                    <strong>Warning</strong>
                    <p>
                        This printer 
                        {% if has_redirect %}has an active redirect{% endif %}
                        {% if has_redirect and is_target %}and {% endif %}
                        {% if is_target %}is being used as a redirect target{% endif %}.
                        IP address cannot be changed while redirects are active.
                    </p>
                </div>
                {% endif %}
                
                <form method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    {% if mode == 'add' %}
                    <div class="form-section">
                        <label for="printer_id" class="form-label-modern">Printer ID <span class="required">*</span></label>
                        <input type="text" class="form-input" id="printer_id" name="printer_id" 
                               value="{{ printer.id if printer else '' }}"
                               pattern="[a-z0-9-]+" 
                               placeholder="e.g., printer-lobby-1"
                               required>
                           <div class="form-error">Use lowercase letters, numbers, and hyphens only.</div>
                        <div class="form-hint">Unique identifier (lowercase letters, numbers, hyphens only)</div>
                    </div>
                    {% else %}
                    <div class="form-section">
                        <label class="form-label-modern">Printer ID</label>
                        <input type="text" class="form-input" value="{{ printer.id }}" disabled>
                        <div class="form-hint">Printer ID cannot be changed</div>
                    </div>
                    {% endif %}
                    
                    <div class="form-section">
                        <label for="name" class="form-label-modern">Printer Name <span class="required">*</span></label>
                        <input type="text" class="form-input" id="name" name="name" 
                               value="{{ printer.name if printer else '' }}"
                               placeholder="e.g., Lobby Printer"
                               required>
                           <div class="form-error">Please provide a printer name.</div>
                           <div class="form-hint">This is the friendly name shown to staff.</div>
                    </div>
                    
                    <div class="form-section">
                        <label for="ip" class="form-label-modern">IP Address <span class="required">*</span></label>
                        <input type="text" class="form-input" id="ip" name="ip" 
                               value="{{ printer.ip if printer else '' }}"
                               pattern="^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$"
                               placeholder="e.g., 192.168.1.100"
                               {% if mode == 'edit' and (has_redirect or is_target) %}readonly{% endif %}
                               required>
                           <div class="form-error">Enter a valid IPv4 address.</div>
                           <div class="form-hint">IPv4 address reachable on your network.</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-section">
                                <label for="location" class="form-label-modern">Location</label>
                                <input type="text" class="form-input" id="location" name="location" 
                                       value="{{ printer.location if printer else '' }}"
                                       placeholder="e.g., Building A, Floor 2">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-section">
                                <label for="department" class="form-label-modern">Department</label>
                                <input type="text" class="form-input" id="department" name="department" 
                                       value="{{ printer.department if printer else '' }}"
                                       placeholder="e.g., Marketing">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <label for="model" class="form-label-modern">Model</label>
                        <input type="text" class="form-input" id="model" name="model" 
                               value="{{ printer.model if printer else '' }}"
                               placeholder="e.g., HP LaserJet Pro M404n">
                    </div>
                    
                    <div class="form-section">
                        <label for="notes" class="form-label-modern">Notes</label>
                        <textarea class="form-input" id="notes" name="notes" rows="3"
                                  placeholder="Any additional notes...">{{ printer.notes if printer else '' }}</textarea>
                    </div>
                    
                    <div class="d-flex justify-content-between pt-2">
                        <a href="{{ url_for('main.manage_printers') }}" class="btn-modern btn-outline-modern">
                            Cancel
                        </a>
                        <button type="submit" class="btn-modern btn-primary-modern">
                            {{ 'Save Changes' if mode == 'edit' else 'Add Printer' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Auto-generate ID from name (only for add mode)
{% if mode == 'add' %}
document.getElementById('name').addEventListener('input', function() {
    const idField = document.getElementById('printer_id');
    if (!idField.dataset.userModified) {
        idField.value = this.value.toLowerCase()
            .replace(/[^a-z0-9]+/g, '-')
            .replace(/^-+|-+$/g, '');
    }
});

document.getElementById('printer_id').addEventListener('input', function() {
    this.dataset.userModified = 'true';
});
{% endif %}
</script>
{% endblock %}
